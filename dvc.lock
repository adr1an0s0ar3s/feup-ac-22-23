schema: '2.0'
stages:
  migrate_database_to_sql:
    cmd: sqlite3 data/database.db -batch -init src/sql/init.sql
    deps:
    - path: data/account.csv
      md5: ef0f49c7954bbbfc783ea36a735b25e1
      size: 156340
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: a14005c0d44ccef3cb9b97755807f121
      size: 382
    - path: src/sql/init.sql
      md5: 8b8563c2b6482e0eb34de27c9db3c670
      size: 129
    outs:
    - path: data/database.db
      md5: 8216bf4ee95d6e069819a693d4b72b52
      size: 376832
  create_database:
    cmd: sqlite3 data/database.db < src/sql/init.sql
    deps:
    - path: data/account.csv
      md5: ef0f49c7954bbbfc783ea36a735b25e1
      size: 156340
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: 8c3e35359cf1324bf1534d5077c84f58
      size: 2359
    - path: src/sql/init.sql
      md5: 65b3f3235365fe21883eefd547fc5635
      size: 340
    outs:
    - path: data/database.db
      md5: 4a4e1fee4fee12ce287ed83e0a4d0ba7
      size: 35721216
  process-data:
    cmd: python3 src/process_data.py
    deps:
    - path: data/database.db
      md5: 4b0d22b4bce55a39428963fa43216774
      size: 35729408
    - path: src/process_data.py
      md5: 60cbd8b96693588f1d7ca25d35c2bffe
      size: 275
    outs:
    - path: data/processed_data.csv
      md5: 1001b78795b07b9a5224f2652f77ee1c
      size: 9448
  split-data:
    cmd: python3 src/split_data.py
    deps:
    - path: data/prepared_data.csv
      md5: 44a7f0d0750436cd3595621fc40a0056
      size: 335277
    - path: src/split_data.py
      md5: b34d4ba11b64fca006880cc60fe5c829
      size: 1108
    outs:
    - path: data/X_test_all_features.csv
      md5: dc810c39011d9bfe0eeca2274fe8a8a2
      size: 109318
    - path: data/X_train_all_features.csv
      md5: e450e964e89a9561e7624b8c52977d49
      size: 218987
    - path: data/y_test.csv
      md5: 86bc2efb42e8469518319e311df1c492
      size: 225
    - path: data/y_train_not_sampled.csv
      md5: 055beba85404061b1874688485c9df1a
      size: 445
  train-model:
    cmd: python3 src/train_model.py
    deps:
    - path: data/X_test.csv
      md5: 0e808574fe09344679a7c0071c375474
      size: 21377
    - path: data/X_train.csv
      md5: dbeb71f4f2eba8fbe72143792d8f7a7b
      size: 73583
    - path: data/y_test.csv
      md5: 86bc2efb42e8469518319e311df1c492
      size: 225
    - path: data/y_train.csv
      md5: 10f8ab5cb10bbde933de246585f42b79
      size: 759
    - path: src/train_model.py
      md5: 493ec0ea0034f904893493706924a37a
      size: 2759
    params:
      params.yaml:
        classifiers:
        - dt
        - knn
        params: {}
    outs:
    - path: data/model.joblib
      md5: 1a3a9914146d57c35b627cc0eefae628
      size: 71483
    - path: metrics/model_details.json
      md5: 7eb1f111415c2bde65594ae72a07d0c0
      size: 200
  test-model:
    cmd: python3 src/test_model.py
    deps:
    - path: data/X_test.csv
      md5: 0e808574fe09344679a7c0071c375474
      size: 21377
    - path: data/model.joblib
      md5: 1a3a9914146d57c35b627cc0eefae628
      size: 71483
    - path: data/y_test.csv
      md5: 86bc2efb42e8469518319e311df1c492
      size: 225
    - path: src/test_model.py
      md5: 04a0d3fb6f5bb80a06dc565862226816
      size: 1933
    outs:
    - path: evaluation/plots/precision_recall.json
      md5: 14b12c6d32276b9c03adff8f5f68d924
      size: 6935
    - path: evaluation/plots/roc.json
      md5: 4ecbdf2af016b7aea96616f5a0ec7ac4
      size: 6730
    - path: metrics/results.json
      md5: 5189ace7ad6648f12ccb992f55d01664
      size: 149
  plot-data:
    cmd: python3 src/data-analysis/account.py && python3 src/data-analysis/client.py
      && python3 src/data-analysis/district.py && python3 src/data-analysis/loan.py
    deps:
    - path: data/database.db
      md5: 61977f21acb1e0b39cfe032648407203
      size: 35737600
    - path: src/data-analysis/account.py
      md5: da39556f9e466f269eff30c4c133872b
      size: 2980
    - path: src/data-analysis/client.py
      md5: 80ca5a42b40ee5cb1decdb0b7efeefdc
      size: 1340
    - path: src/data-analysis/district.py
      md5: 906c963c595b005722d8409eba86f42d
      size: 3919
    - path: src/data-analysis/loan.py
      md5: e4a72439f85d10ece4872b5af179cc94
      size: 2240
    outs:
    - path: analysis_plots/accounts_created_per_year.png
      md5: edaf501f29a3264bbc24255ab7e6b8a9
      size: 21499
    - path: analysis_plots/clients_sex_distribution.png
      md5: 6bfd0adbc03293fb17a9dc5cbaeadec5
      size: 14559
    - path: analysis_plots/corr_accounts_per_district_with_district_table.png
      md5: d4ab3592243132420f7488e1420cfd90
      size: 59250
    - path: analysis_plots/district_corr.png
      md5: d3b3333ab27b10104b5ccbec881a3efb
      size: 185195
    - path: analysis_plots/district_loan_by_district.png
      md5: 2d414a4179d97b5768bccda63c1dedc3
      size: 109031
    - path: analysis_plots/district_loan_by_region.png
      md5: 4f00f4f27a2644179d088080bebef1a5
      size: 33914
    - path: analysis_plots/issuance_frequency_categories_count.png
      md5: 8ae54d2d836576de965696f48d502d8c
      size: 34625
    - path: analysis_plots/loan_amount_boxplot.png
      md5: 110aa64e046ba3e975dba7fa2a14fbe6
      size: 21936
    - path: analysis_plots/loan_amount_distribution0.png
      md5: 9a2eb508a7c09eaf330fa0dc95c9efcb
      size: 29743
    - path: analysis_plots/loan_amount_distribution1.png
      md5: fdf4e1d4b682720870c1a5bdc4339324
      size: 37530
    - path: analysis_plots/loan_amount_over_time.png
      md5: d34a1f8b86b1ff7ef4573d727e41557d
      size: 49420
    - path: analysis_plots/number_clients_per_decade_birth.png
      md5: 2e340df058d1fca688852b6641bb0943
      size: 22419
    - path: analysis_plots/top10_districts_most_accounts.png
      md5: 766ec2881166efe93ad420d773c1b196
      size: 43944
  create-database:
    cmd: sqlite3 data/database.db ".read src/sql/init.sql" ".read src/sql/create_data_integration_views.sql"
      ".read src/sql/create_data_feature_engineering_views.sql"
    deps:
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: 8ac810b5c26e4e278595b6a51a215597
      size: 2359
    - path: src/sql/create_data_feature_engineering_views.sql
      md5: fcd774b01c670cfcc44da71f4aec5984
      size: 9748
    - path: src/sql/create_data_integration_views.sql
      md5: e1922dfc24abcb531fdf42b05da83664
      size: 1673
    - path: src/sql/init.sql
      md5: 65b3f3235365fe21883eefd547fc5635
      size: 340
    outs:
    - path: data/database.db
      md5: 61977f21acb1e0b39cfe032648407203
      size: 35737600
  unify-data:
    cmd: python3 src/unify_data.py
    deps:
    - path: data/database.db
      md5: 61977f21acb1e0b39cfe032648407203
      size: 35737600
    - path: src/unify_data.py
      md5: ee1294c54d0b120e0e56a78dd448ecf4
      size: 2710
    outs:
    - path: data/unified_data.csv
      md5: ca9956efd6d671d8582cd2a54fa69dea
      size: 81115
  clean-redundancy:
    cmd: python3 src/data-cleaning/redundancy.py
    deps:
    - path: data/unified_data.csv
      md5: ca9956efd6d671d8582cd2a54fa69dea
      size: 81115
    - path: src/data-cleaning/redundancy.py
      md5: c35531d349652dff80844f85278cf44a
      size: 168
    outs:
    - path: data/clean_data0.csv
      md5: 81e67dc821872c8994702cce011f2c29
      size: 80845
  clean-missing-data:
    cmd: python3 src/data-cleaning/missing_data.py
    deps:
    - path: data/clean_data0.csv
      md5: 81e67dc821872c8994702cce011f2c29
      size: 80845
    - path: src/data-cleaning/missing_data.py
      md5: d789030e5611ddbf48b8f2a03b5d2fa6
      size: 810
    outs:
    - path: data/clean_data1.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
  clean-outliers:
    cmd: python3 src/data-cleaning/outliers.py
    deps:
    - path: data/clean_data1.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
    - path: src/data-cleaning/outliers.py
      md5: 75d1b1f667b4366847d9c6b3b826524b
      size: 166
    outs:
    - path: data/clean_data.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
  sample-data:
    cmd: python3 src/sample_data.py
    deps:
    - path: data/X_train_not_sampled.csv
      md5: 56d17d94aa73feb7076d11624b3281cb
      size: 42818
    - path: data/y_train_not_sampled.csv
      md5: 055beba85404061b1874688485c9df1a
      size: 445
    - path: src/sample_data.py
      md5: 88023f8d2d69100f057782f42647d40d
      size: 486
    outs:
    - path: data/X_train.csv
      md5: dbeb71f4f2eba8fbe72143792d8f7a7b
      size: 73583
    - path: data/y_train.csv
      md5: 10f8ab5cb10bbde933de246585f42b79
      size: 759
  transform-data:
    cmd: python3 src/data_transformation.py
    deps:
    - path: data/clean_data.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
    - path: src/data_transformation.py
      md5: f4290f263d97cf54528ca70863e10eb1
      size: 907
    outs:
    - path: data/prepared_data.csv
      md5: 44a7f0d0750436cd3595621fc40a0056
      size: 335277
  select-features:
    cmd: python3 src/feature_selection.py
    deps:
    - path: data/X_test_all_features.csv
      md5: dc810c39011d9bfe0eeca2274fe8a8a2
      size: 109318
    - path: data/X_train_all_features.csv
      md5: e450e964e89a9561e7624b8c52977d49
      size: 218987
    - path: data/y_train_not_sampled.csv
      md5: 055beba85404061b1874688485c9df1a
      size: 445
    - path: src/feature_selection.py
      md5: d84baa26c091c1530fe252a801b23ea8
      size: 2135
    params:
      params.yaml:
        feature_selection:
          filter: kbest
          wrapper: none
    outs:
    - path: data/X_test.csv
      md5: 0e808574fe09344679a7c0071c375474
      size: 21377
    - path: data/X_train_not_sampled.csv
      md5: 56d17d94aa73feb7076d11624b3281cb
      size: 42818
