schema: '2.0'
stages:
  migrate_database_to_sql:
    cmd: sqlite3 data/database.db -batch -init src/sql/init.sql
    deps:
    - path: data/account.csv
      md5: ef0f49c7954bbbfc783ea36a735b25e1
      size: 156340
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: a14005c0d44ccef3cb9b97755807f121
      size: 382
    - path: src/sql/init.sql
      md5: 8b8563c2b6482e0eb34de27c9db3c670
      size: 129
    outs:
    - path: data/database.db
      md5: 8216bf4ee95d6e069819a693d4b72b52
      size: 376832
  create_database:
    cmd: sqlite3 data/database.db < src/sql/init.sql
    deps:
    - path: data/account.csv
      md5: ef0f49c7954bbbfc783ea36a735b25e1
      size: 156340
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: 8c3e35359cf1324bf1534d5077c84f58
      size: 2359
    - path: src/sql/init.sql
      md5: 65b3f3235365fe21883eefd547fc5635
      size: 340
    outs:
    - path: data/database.db
      md5: 4a4e1fee4fee12ce287ed83e0a4d0ba7
      size: 35721216
  process-data:
    cmd: python3 src/process_data.py
    deps:
    - path: data/database.db
      md5: 4b0d22b4bce55a39428963fa43216774
      size: 35729408
    - path: src/process_data.py
      md5: 60cbd8b96693588f1d7ca25d35c2bffe
      size: 275
    outs:
    - path: data/processed_data.csv
      md5: 1001b78795b07b9a5224f2652f77ee1c
      size: 9448
  split-data:
    cmd: python3 src/split_data.py
    deps:
    - path: data/X.csv
      md5: 5666fa636b828345cb7142e4b8fa4dca
      size: 54769
    - path: data/y.csv
      md5: 740df0bdb629d6659829f52a51446f60
      size: 1135
    - path: src/split_data.py
      md5: b6d3a25a45f5a43954a3eaf2aee49093
      size: 581
    outs:
    - path: data/X_test.csv
      md5: 6edcc1d924ab9752cbf806bbe54f4516
      size: 13857
    - path: data/X_train.csv
      md5: 16504bcea9edc1935903a83e93c6f203
      size: 41151
    - path: data/y_test.csv
      md5: c0e530528c64a06e3573ae633c4793cc
      size: 289
    - path: data/y_train.csv
      md5: d23e1bfb223d5896a757808dca989937
      size: 853
  train-model:
    cmd: python3 src/train_model.py
    deps:
    - path: data/X_test.csv
      md5: 6edcc1d924ab9752cbf806bbe54f4516
      size: 13857
    - path: data/X_train.csv
      md5: 16504bcea9edc1935903a83e93c6f203
      size: 41151
    - path: data/y_test.csv
      md5: c0e530528c64a06e3573ae633c4793cc
      size: 289
    - path: data/y_train.csv
      md5: d23e1bfb223d5896a757808dca989937
      size: 853
    - path: src/train_model.py
      md5: 9c41b689cc8a7c3be7bbbcd5b7eb8708
      size: 809
    params:
      params.yaml:
        train:
          max_depth: 100
    outs:
    - path: data/model.joblib
      md5: 999b5cbf998452300dc966585cda353a
      size: 10297
  test-model:
    cmd: python3 src/test_model.py
    deps:
    - path: data/X_test.csv
      md5: 6edcc1d924ab9752cbf806bbe54f4516
      size: 13857
    - path: data/model.joblib
      md5: 999b5cbf998452300dc966585cda353a
      size: 10297
    - path: data/y_test.csv
      md5: c0e530528c64a06e3573ae633c4793cc
      size: 289
    - path: src/test_model.py
      md5: 04a0d3fb6f5bb80a06dc565862226816
      size: 1933
    outs:
    - path: evaluation/plots/precision_recall.json
      md5: 2c8ae98332c9adedab30a109c56308de
      size: 280
    - path: evaluation/plots/roc.json
      md5: 7ada49a0ab64ce2f9d2d4d0034bbd6a8
      size: 345
    - path: metrics/results.json
      md5: 313d5edb89d9551f1174a7520a11753c
      size: 147
  plot-data:
    cmd: python3 src/data-analysis/account.py && python3 src/data-analysis/client.py
      && python3 src/data-analysis/district.py && python3 src/data-analysis/loan.py
    deps:
    - path: data/database.db
      md5: de86fc14da61c2e483be4762bc22206a
      size: 35729408
    - path: src/data-analysis/account.py
      md5: da39556f9e466f269eff30c4c133872b
      size: 2980
    - path: src/data-analysis/client.py
      md5: 80ca5a42b40ee5cb1decdb0b7efeefdc
      size: 1340
    - path: src/data-analysis/district.py
      md5: 906c963c595b005722d8409eba86f42d
      size: 3919
    - path: src/data-analysis/loan.py
      md5: e4a72439f85d10ece4872b5af179cc94
      size: 2240
    outs:
    - path: analysis_plots/accounts_created_per_year.png
      md5: c58edf3b514f820f47ebb04a53179bc0
      size: 21499
    - path: analysis_plots/clients_sex_distribution.png
      md5: 71bf9989c77179534fc22625179b7462
      size: 14559
    - path: analysis_plots/corr_accounts_per_district_with_district_table.png
      md5: ad8b7a064760836d5218db7abe397676
      size: 59250
    - path: analysis_plots/district_corr.png
      md5: be2e49f0a7ab659405ab67a84530da99
      size: 185195
    - path: analysis_plots/district_loan_by_district.png
      md5: 2e9b7dd9e1b0657651af56dc51a3b85c
      size: 109031
    - path: analysis_plots/district_loan_by_region.png
      md5: ef78a56fa4330d0f658745f469cd4a68
      size: 33914
    - path: analysis_plots/issuance_frequency_categories_count.png
      md5: dda76a24b939ee8c19dc1a6c29e140d3
      size: 34625
    - path: analysis_plots/loan_amount_boxplot.png
      md5: c5cefa3758f36970bd5332b468d50652
      size: 21936
    - path: analysis_plots/loan_amount_distribution0.png
      md5: 5a20f6cbd7d8d318e19ecc126d320dc0
      size: 29743
    - path: analysis_plots/loan_amount_distribution1.png
      md5: 6edeb6522b0d38376840892ddc4f44b6
      size: 37530
    - path: analysis_plots/loan_amount_over_time.png
      md5: d6e098d3d593777891cebaa9474a2586
      size: 49275
    - path: analysis_plots/number_clients_per_decade_birth.png
      md5: 1602baba3620c5f25791b9072573ddfd
      size: 22419
    - path: analysis_plots/top10_districts_most_accounts.png
      md5: 81ef310d34eacb2ed3cfdc7fbda760b0
      size: 43944
  create-database:
    cmd: sqlite3 data/database.db ".read src/sql/init.sql" ".read src/sql/create_data_integration_views.sql"
      ".read src/sql/create_data_feature_engineering_views.sql"
    deps:
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: 8c3e35359cf1324bf1534d5077c84f58
      size: 2359
    - path: src/sql/create_data_feature_engineering_views.sql
      md5: f2d27d7e82efcfdd26ee4fa31b8d0a01
      size: 3438
    - path: src/sql/create_data_integration_views.sql
      md5: e1922dfc24abcb531fdf42b05da83664
      size: 1673
    - path: src/sql/init.sql
      md5: 65b3f3235365fe21883eefd547fc5635
      size: 340
    outs:
    - path: data/database.db
      md5: de86fc14da61c2e483be4762bc22206a
      size: 35729408
  unify-data:
    cmd: python3 src/unify_data.py
    deps:
    - path: data/database.db
      md5: de86fc14da61c2e483be4762bc22206a
      size: 35729408
    - path: src/unify_data.py
      md5: 552b1849fa91d7457be097157e64a65d
      size: 1166
    outs:
    - path: data/unified_data.csv
      md5: d1760a3f58b4dd9b253e38c9ff32fc83
      size: 57350
  clean-redundancy:
    cmd: python3 src/data-cleaning/redundancy.py
    deps:
    - path: data/unified_data.csv
      md5: d1760a3f58b4dd9b253e38c9ff32fc83
      size: 57350
    - path: src/data-cleaning/redundancy.py
      md5: c35531d349652dff80844f85278cf44a
      size: 168
    outs:
    - path: data/clean_data0.csv
      md5: 22ce6cf0068dfaa175fd4b4411b92054
      size: 57216
  clean-missing-data:
    cmd: python3 src/data-cleaning/missing_data.py
    deps:
    - path: data/clean_data0.csv
      md5: 22ce6cf0068dfaa175fd4b4411b92054
      size: 57216
    - path: src/data-cleaning/missing_data.py
      md5: 603abbc0aff83c4198ba20f7e943e827
      size: 718
    outs:
    - path: data/clean_data1.csv
      md5: 45ad492a62315ec6f80a81b3e4f4a2da
      size: 56863
  clean-outliers:
    cmd: python3 src/data-cleaning/outliers.py
    deps:
    - path: data/clean_data1.csv
      md5: 45ad492a62315ec6f80a81b3e4f4a2da
      size: 56863
    - path: src/data-cleaning/outliers.py
      md5: 75d1b1f667b4366847d9c6b3b826524b
      size: 166
    outs:
    - path: data/clean_data.csv
      md5: 45ad492a62315ec6f80a81b3e4f4a2da
      size: 56863
  sample-data:
    cmd: python3 src/sample_data.py
    deps:
    - path: data/prepared_data.csv
      md5: dca5d506b49f6fde6d2e332d81f5cbf1
      size: 55487
    - path: src/sample_data.py
      md5: 6f63b2dd5af32553bbbc76c65551d330
      size: 648
    outs:
    - path: data/sampled_X.csv
      md5: 6896d76341dde2975534f7c37dccfd09
      size: 101291
    - path: data/sampled_y.csv
      md5: 740df0bdb629d6659829f52a51446f60
      size: 1135
  transform-data:
    cmd: python3 src/data_transformation.py
    deps:
    - path: data/clean_data.csv
      md5: 45ad492a62315ec6f80a81b3e4f4a2da
      size: 56863
    - path: src/data_transformation.py
      md5: 478d6cc3bce4c2102c8740318d53e7e3
      size: 730
    outs:
    - path: data/prepared_data.csv
      md5: dca5d506b49f6fde6d2e332d81f5cbf1
      size: 55487
  select-features:
    cmd: python3 src/feature_selection.py
    deps:
    - path: data/sampled_X.csv
      md5: 6896d76341dde2975534f7c37dccfd09
      size: 101291
    - path: data/sampled_y.csv
      md5: 740df0bdb629d6659829f52a51446f60
      size: 1135
    - path: src/feature_selection.py
      md5: a560892b6aef8c65e1e8b2c66fc430cc
      size: 662
    outs:
    - path: data/X.csv
      md5: 5666fa636b828345cb7142e4b8fa4dca
      size: 54769
    - path: data/y.csv
      md5: 740df0bdb629d6659829f52a51446f60
      size: 1135
