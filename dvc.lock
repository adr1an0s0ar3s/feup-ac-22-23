schema: '2.0'
stages:
  create-database:
    cmd: sqlite3 data/database.db ".read src/sql/init.sql" ".read src/sql/create_data_integration_views.sql"
      ".read src/sql/create_data_feature_engineering_views.sql"
    deps:
    - path: data/card_dev.csv
      md5: 7aaa57fe06bd39e81fa7dba9a9d27fb3
      size: 4328
    - path: data/client.csv
      md5: 487458958bfdc1040ec8fd3fd4f6c01b
      size: 94820
    - path: data/disp.csv
      md5: d6d137e58d95b0522ce284bcecb1c2c9
      size: 129716
    - path: data/district.csv
      md5: 14aa6edfb2fa331dcd98aed1256b6d65
      size: 6642
    - path: data/loan_dev.csv
      md5: 92611660fdf3cffd844726e59360d764
      size: 11424
    - path: data/trans_dev.csv
      md5: c6f59a61bdc6227463d27b28727d2a14
      size: 33243199
    - path: src/sql/create.sql
      md5: 69ec60d64e4b69715cc3564fc8f004cc
      size: 2350
    - path: src/sql/create_data_feature_engineering_views.sql
      md5: fcd774b01c670cfcc44da71f4aec5984
      size: 9748
    - path: src/sql/create_data_integration_views.sql
      md5: e1922dfc24abcb531fdf42b05da83664
      size: 1673
    - path: src/sql/init.sql
      md5: 65b3f3235365fe21883eefd547fc5635
      size: 340
    outs:
    - path: data/database.db
      md5: 9ae870fee84dd3e03b6e978110a7092c
      size: 35737600
  unify-data:
    cmd: python3 src/unify_data.py
    deps:
    - path: data/database.db
      md5: 9ae870fee84dd3e03b6e978110a7092c
      size: 35737600
    - path: src/unify_data.py
      md5: 509c5c813446ffef9a42c5e502871a72
      size: 2823
    outs:
    - path: data/unified_data.csv
      md5: ca9956efd6d671d8582cd2a54fa69dea
      size: 81115
  clean-redundancy:
    cmd: python3 src/data-cleaning/redundancy.py
    deps:
    - path: data/unified_data.csv
      md5: ca9956efd6d671d8582cd2a54fa69dea
      size: 81115
    - path: src/data-cleaning/redundancy.py
      md5: da6e35d61d84ac3701cbcea2a2ec0992
      size: 171
    outs:
    - path: data/clean_data0.csv
      md5: 81e67dc821872c8994702cce011f2c29
      size: 80845
  clean-missing-data:
    cmd: python3 src/data-cleaning/missing_data.py
    deps:
    - path: data/clean_data0.csv
      md5: 81e67dc821872c8994702cce011f2c29
      size: 80845
    - path: src/data-cleaning/missing_data.py
      md5: 53c7c3958c3cbf1ebddce1aebb2ff5d8
      size: 802
    outs:
    - path: data/clean_data1.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
  clean-outliers:
    cmd: python3 src/data-cleaning/outliers.py
    deps:
    - path: data/clean_data1.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
    - path: src/data-cleaning/outliers.py
      md5: 9094553b59be409e5ed45fd617400dc5
      size: 169
    outs:
    - path: data/clean_data.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
  transform-data:
    cmd: python3 src/data_transformation.py
    deps:
    - path: data/clean_data.csv
      md5: 0531f4a5eed6e0c73e10c40b99344c1a
      size: 82404
    - path: src/data_transformation.py
      md5: 98e2690f093f546559a7cd9a70dfc516
      size: 1007
    outs:
    - path: data/prepared_data.csv
      md5: 44a7f0d0750436cd3595621fc40a0056
      size: 335277
    - path: data/scaler.joblib
      md5: 92c9402c23e0bc7f643ac84c3783fa8c
      size: 3426
  split-data:
    cmd: python3 src/split_data.py
    deps:
    - path: data/prepared_data.csv
      md5: 44a7f0d0750436cd3595621fc40a0056
      size: 335277
    - path: src/split_data.py
      md5: 4ef87e741309138461c031b236619cdc
      size: 1165
    outs:
    - path: data/X_test_all_features.csv
      md5: e592b7b97ebdb87f6f1673a50d4ef7c7
      size: 66592
    - path: data/X_train_not_sampled.csv
      md5: 879a310fcd68153a98abab204a8b7225
      size: 261713
    - path: data/y_test.csv
      md5: c5fb61bc3ed0ddbbf8f03a48748d59b6
      size: 139
    - path: data/y_train_not_sampled.csv
      md5: ad20a8766930f7e0dd04bae58e772a57
      size: 531
  sample-data:
    cmd: python3 src/sample_data.py
    deps:
    - path: data/X_train_not_sampled.csv
      md5: 879a310fcd68153a98abab204a8b7225
      size: 261713
    - path: data/y_train_not_sampled.csv
      md5: ad20a8766930f7e0dd04bae58e772a57
      size: 531
    - path: src/sample_data.py
      md5: 5051f7f1d8a180846d5baa843ebb9588
      size: 482
    outs:
    - path: data/X_train_all_features.csv
      md5: dfed4cf8313a60bb67ceadbe090a9b7b
      size: 443096
    - path: data/y_train.csv
      md5: 3043f97501976c316162dfd7ca2be46b
      size: 891
  select-features:
    cmd: python3 src/feature_selection.py
    deps:
    - path: data/X_test_all_features.csv
      md5: e592b7b97ebdb87f6f1673a50d4ef7c7
      size: 66592
    - path: data/X_train_all_features.csv
      md5: dfed4cf8313a60bb67ceadbe090a9b7b
      size: 443096
    - path: data/y_train.csv
      md5: 3043f97501976c316162dfd7ca2be46b
      size: 891
    - path: src/feature_selection.py
      md5: d5634aea722a1d824f61c035a4a21cea
      size: 2994
    params:
      params.yaml:
        feature_selection.estimator: perceptron
        feature_selection.filter: variance
        feature_selection.wrapper: none
        manual_feature_selection: false
        manual_feature_selection_fields:
        - balance
        - timesIntoNegativeBalance
        - numTransactionsNegBalance
    outs:
    - path: data/X_test.csv
      md5: 73988b2f85bf19f61c4e3fa01c7167b1
      size: 65272
    - path: data/X_train.csv
      md5: 8d8512873f13e15dfaea42d75c77d23d
      size: 432388
    - path: data/features.csv
      md5: 8e1b33b97d9fe6bec50b2d9d6ac8c2a3
      size: 994
  train-model:
    cmd: python3 src/train_model.py
    deps:
    - path: data/X_test.csv
      md5: 73988b2f85bf19f61c4e3fa01c7167b1
      size: 65272
    - path: data/X_train.csv
      md5: 8d8512873f13e15dfaea42d75c77d23d
      size: 432388
    - path: data/y_test.csv
      md5: c5fb61bc3ed0ddbbf8f03a48748d59b6
      size: 139
    - path: data/y_train.csv
      md5: 3043f97501976c316162dfd7ca2be46b
      size: 891
    - path: src/train_model.py
      md5: 7daf8176defbba1104676a19f31c2ef5
      size: 4321
    params:
      params.yaml:
        classifiers:
        - rf
        params: {}
    outs:
    - path: data/model.joblib
      md5: 9af7f0a694e401c6f446bd0a8066d517
      size: 613247
    - path: metrics/model_details.json
      md5: 1b56bfc6b63bad1996527b385cae636e
      size: 471
  test-model:
    cmd: python3 src/test_model.py
    deps:
    - path: data/X_test.csv
      md5: 73988b2f85bf19f61c4e3fa01c7167b1
      size: 65272
    - path: data/model.joblib
      md5: 9af7f0a694e401c6f446bd0a8066d517
      size: 613247
    - path: data/y_test.csv
      md5: c5fb61bc3ed0ddbbf8f03a48748d59b6
      size: 139
    - path: src/test_model.py
      md5: 1d8041b2d1541a6d6a91ff4669d0dfba
      size: 2205
    outs:
    - path: evaluation/plots/precision_recall.json
      md5: 34f8e4b3d195a81fca74161bc147833a
      size: 4941
    - path: evaluation/plots/roc.json
      md5: 1217d648abf1123ce3c167f4f3fad0e0
      size: 4762
    - path: metrics/results.json
      md5: a9c346aba6430c9afa521f70dcbc6a88
      size: 157
  clustering:
    cmd: python3 src/cluster_data.py
    deps:
    - path: data/prepared_data.csv
      md5: 44a7f0d0750436cd3595621fc40a0056
      size: 335277
    - path: data/scaler.joblib
      md5: 92c9402c23e0bc7f643ac84c3783fa8c
      size: 3426
    - path: src/cluster_data.py
      md5: 03691b6779c4a9111dc1088e5c3737c2
      size: 2921
  plot-data:
    cmd: python3 src/data-analysis/account.py && python3 src/data-analysis/client.py
      && python3 src/data-analysis/district.py && python3 src/data-analysis/loan.py
    deps:
    - path: data/database.db
      md5: 9ae870fee84dd3e03b6e978110a7092c
      size: 35737600
    - path: src/data-analysis/account.py
      md5: cc663200da505e93b08fdb907f5aa062
      size: 3041
    - path: src/data-analysis/client.py
      md5: ce96c8b48f89610200e322d071c1aa98
      size: 1391
    - path: src/data-analysis/district.py
      md5: 45e730dc128b5870ad137e5caaed79dd
      size: 4149
    - path: src/data-analysis/loan.py
      md5: 40526c6f928ff76ecb8906e71198d00b
      size: 2343
    outs:
    - path: analysis_plots/accounts_created_per_year.png
      md5: c58edf3b514f820f47ebb04a53179bc0
      size: 21499
    - path: analysis_plots/clients_sex_distribution.png
      md5: 71bf9989c77179534fc22625179b7462
      size: 14559
    - path: analysis_plots/corr_accounts_per_district_with_district_table.png
      md5: ad8b7a064760836d5218db7abe397676
      size: 59250
    - path: analysis_plots/district_corr.png
      md5: be2e49f0a7ab659405ab67a84530da99
      size: 185195
    - path: analysis_plots/district_loan_by_district.png
      md5: 2e9b7dd9e1b0657651af56dc51a3b85c
      size: 109031
    - path: analysis_plots/district_loan_by_region.png
      md5: ef78a56fa4330d0f658745f469cd4a68
      size: 33914
    - path: analysis_plots/issuance_frequency_categories_count.png
      md5: dda76a24b939ee8c19dc1a6c29e140d3
      size: 34625
    - path: analysis_plots/loan_amount_boxplot.png
      md5: c5cefa3758f36970bd5332b468d50652
      size: 21936
    - path: analysis_plots/loan_amount_distribution0.png
      md5: 5a20f6cbd7d8d318e19ecc126d320dc0
      size: 29743
    - path: analysis_plots/loan_amount_distribution1.png
      md5: 6edeb6522b0d38376840892ddc4f44b6
      size: 37530
    - path: analysis_plots/loan_amount_over_time.png
      md5: 5515d920f048c5c8044baf0d3fdb8d47
      size: 49446
    - path: analysis_plots/number_clients_per_decade_birth.png
      md5: 1602baba3620c5f25791b9072573ddfd
      size: 22419
    - path: analysis_plots/top10_districts_most_accounts.png
      md5: 81ef310d34eacb2ed3cfdc7fbda760b0
      size: 43944
